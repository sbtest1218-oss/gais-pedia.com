# GAISペディア - 生成AI協会公式ナレッジアシスタント

**🌐 サービスURL: https://gais-pedia.com**

---

## 📋 目次

1. [サービス概要](#サービス概要)
2. [主な機能](#主な機能)
3. [技術スタック](#技術スタック)
4. [システムアーキテクチャ](#システムアーキテクチャ)
5. [AI技術の活用](#ai技術の活用)
6. [データ収集・更新](#データ収集更新)
7. [セキュリティ対策](#セキュリティ対策)
8. [ユーザーインターフェース](#ユーザーインターフェース)
9. [セットアップ手順](#セットアップ手順)
10. [運用・保守](#運用保守)

---

## サービス概要

### GAISペディアとは？

GAISペディアは、**生成AI協会（GAIS：Generative AI Association）** の公式情報を、AI技術を活用して誰でも簡単に検索・取得できるナレッジアシスタントです。

従来、生成AI協会の情報を調べるには公式サイト（gais.jp）を直接閲覧し、複数のページを探し回る必要がありました。GAISペディアは、この課題を解決するために開発されました。

### 解決する課題

| 従来の課題 | GAISペディアによる解決 |
|-----------|----------------------|
| 公式サイトの情報が分散している | AIが関連ページを自動選定し、統合的に回答 |
| 必要な情報を見つけるのに時間がかかる | 自然言語で質問するだけで即座に回答 |
| 過去のイベント情報と今後の情報の区別が難しい | AIが日付を考慮し、終了済み・今後の予定を明記 |
| よくある質問への回答が蓄積されない | 「みんなの質問と回答」機能で過去Q&Aを共有 |

### コンセプト

**「AIで、GAISをもっと身近に」**

生成AI技術を活用して、生成AI協会の情報アクセシビリティを向上させることで、より多くの方にGAISの活動を知っていただき、AIコミュニティの発展に貢献することを目指しています。

---

## 主な機能

### 1. AIチャットボット機能

#### 概要
ユーザーが自然言語で質問を入力すると、AIが生成AI協会の公式情報から最適な回答を生成します。

#### 特徴
- **日本語対応**: 全ての回答は日本語で提供されます
- **コンテキスト理解**: 会話履歴を保持し、文脈を理解した回答が可能
- **ソース明示**: 回答の根拠となったページURLを必ず明記
- **リアルタイム応答**: ストリーミングではないものの、高速なレスポンスを実現

#### 質問例
- 「GAISに入会するにはどうすればいいですか？」
- 「次回のイベントはいつですか？」
- 「法人会員と個人会員の違いを教えてください」
- 「過去のセミナーについて教えてください」

### 2. みんなの質問と回答

#### 概要
過去にユーザーが質問した内容と、AIの回答を一覧で閲覧できる機能です。同じ疑問を持つ他のユーザーの参考になります。

#### 特徴
- **2つのソート方式**:
  - 新着順：最新の質問から表示
  - 人気順：「役立った」が多い順に表示
- **役立ったボタン**: 有用な回答にワンクリックで「いいね」を付与（トグル式で取り消しも可能）
- **質問の再利用**: 気になる質問をクリックしてチャットに復元可能
- **無限スクロール対応**: 大量の質問でも快適に閲覧

### 3. ヘルプポップアップ

#### 概要
各ページに「？」ボタンを設置し、ツールの使い方を分かりやすく説明するポップアップを表示します。

#### 特徴
- アニメーション付きで視覚的に分かりやすい
- ダークモード対応
- ページごとに適切な説明文を表示

### 4. ダークモード

#### 概要
ユーザーの好みや環境に合わせて、ライトモードとダークモードを切り替えられます。

#### 特徴
- ワンクリックで切り替え
- 設定はローカルストレージに保存され、次回訪問時も維持
- 目に優しいカラースキームを採用

### 5. 会話履歴管理

#### 概要
チャットの会話履歴をブラウザに保存し、ページを離れても会話を継続できます。

#### 特徴
- ローカルストレージによる永続化
- 「履歴をクリア」ボタンで簡単にリセット
- プライバシーに配慮（サーバーには会話履歴を保存しない）

---

## 技術スタック

### バックエンド

| 技術 | バージョン | 用途 |
|-----|----------|------|
| PHP | 8.3 | サーバーサイド言語 |
| Laravel | 11.x | Webアプリケーションフレームワーク |
| MySQL | 8.0 | データベース |
| Composer | 2.7 | PHPパッケージ管理 |

### フロントエンド

| 技術 | 用途 |
|-----|------|
| Blade | Laravelテンプレートエンジン |
| Tailwind CSS | UIスタイリング |
| Vanilla JavaScript | インタラクティブ機能 |
| Google Fonts (Noto Sans JP) | 日本語フォント |

### AI・外部API

| サービス | モデル/機能 | 用途 |
|---------|-----------|------|
| Google Gemini | gemini-2.5-flash | チャット応答生成 |
| Gemini url_context | - | Webページ内容の取得・理解 |

### インフラストラクチャ

| サービス | 用途 |
|---------|------|
| Amazon EC2 | アプリケーションサーバー |
| Amazon CloudFront | CDN・SSL終端 |
| AWS WAF | Webアプリケーションファイアウォール |
| Docker | コンテナ化 |
| nginx | Webサーバー |

---

## システムアーキテクチャ

### 全体構成図

```
┌─────────────────────────────────────────────────────────────┐
│                        ユーザー                              │
│                     (ブラウザ)                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Amazon CloudFront                        │
│                   (CDN + SSL終端)                           │
│                 ドメイン: gais-pedia.com                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      AWS WAF                                │
│              (不正アクセス防止・DDoS対策)                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                     Amazon EC2                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   Docker                             │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────────┐  │   │
│  │  │  nginx   │──│   PHP    │──│     MySQL        │  │   │
│  │  │  :80     │  │  8.3-fpm │  │      8.0         │  │   │
│  │  └──────────┘  └──────────┘  └──────────────────┘  │   │
│  │                     │                               │   │
│  │               Laravel 11.x                          │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                  Google Gemini API                          │
│              (gemini-2.5-flash + url_context)               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      gais.jp                                │
│                (生成AI協会 公式サイト)                       │
└─────────────────────────────────────────────────────────────┘
```

### データフロー

1. ユーザーがブラウザから質問を送信
2. CloudFront経由でSSL通信を確立
3. WAFで不正リクエストをフィルタリング
4. EC2上のLaravelアプリケーションがリクエストを処理
5. 2段階AIアーキテクチャで回答を生成（後述）
6. 回答をユーザーに返却

---

## AI技術の活用

### 2段階AIアーキテクチャ

GAISペディアの最大の特徴は、**2段階のAI処理**を行うことで、高精度かつ効率的な回答を実現していることです。

#### 第1段階：インテリジェントURL選定

```
┌──────────────────────────────────────────────────────────┐
│                   ユーザーの質問                          │
│        「次回のイベントはいつですか？」                   │
└──────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────┐
│              データベース（gais_pages）                   │
│   ┌────────────────────────────────────────────────┐    │
│   │ ID: 1  | GAIS設立総会のお知らせ    | 2024/01/15│    │
│   │ ID: 2  | 第5回セミナー開催         | 2024/02/20│    │
│   │ ID: 3  | 会員規約について          | -         │    │
│   │ ID: 4  | 第6回セミナー予定         | 2025/03/10│    │
│   │ ...                                            │    │
│   └────────────────────────────────────────────────┘    │
└──────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────┐
│              Gemini AI（URL選定モード）                   │
│                                                          │
│  「この質問に回答するのに最適なページを                   │
│   最大3つ選んでください」                                │
│                                                          │
│  選定結果: [4, 2]  ← 未来のイベント優先                 │
└──────────────────────────────────────────────────────────┘
```

#### 第2段階：コンテキスト理解と回答生成

```
┌──────────────────────────────────────────────────────────┐
│                選定されたURL（最大3つ）                   │
│  - https://gais.jp/seminar/6th/                         │
│  - https://gais.jp/seminar/5th/                         │
└──────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────┐
│              Gemini url_context機能                      │
│                                                          │
│  指定URLの内容をリアルタイムで取得・解析                 │
└──────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────┐
│              Gemini AI（回答生成モード）                  │
│                                                          │
│  システムプロンプト:                                     │
│  - 日本語で回答                                         │
│  - 該当情報がなければ「見つかりませんでした」と回答     │
│  - 過去イベントは「終了済み」と明記                      │
│  - 参照URLを明記                                        │
│                                                          │
│  回答:                                                  │
│  「次回のイベントは2025年3月10日に開催予定の            │
│   第6回セミナーです。詳細は...                          │
│   参照: https://gais.jp/seminar/6th/」                  │
└──────────────────────────────────────────────────────────┘
```

### なぜ2段階アーキテクチャなのか？

| 課題 | 解決策 |
|-----|-------|
| 全URLを一度に送るとトークン数が膨大になる | 第1段階で関連URLを最大3つに絞り込み |
| 古い情報と新しい情報の区別が難しい | DB内の日付情報を活用して選定時に考慮 |
| ノイズとなる情報（AIニュース等）が含まれる | AIニュース記事を除外するフィルタリング |
| 回答精度のバラつき | 厳密なシステムプロンプトで品質を担保 |

### 使用AIモデル

**Gemini 2.5 Flash** を採用した理由：

1. **高速なレスポンス**: Flashモデルは応答速度に優れ、ユーザー体験を向上
2. **url_context対応**: URLの内容を直接理解できる機能をネイティブサポート
3. **コスト効率**: 高性能でありながらコストパフォーマンスに優れる
4. **日本語対応**: 日本語の理解・生成能力が高い

---

## データ収集・更新

### 自動スクレイピングシステム

GAISペディアは、gais.jp公式サイトの情報を自動的に収集・更新するシステムを備えています。

#### スクレイピング対象

- gais.jpドメイン内の全公開ページ
- イベント情報、お知らせ、会員情報、規約等

#### 除外対象

- 生成AIニュース記事（外部ニュースへのリンク集のため）
- 重複ページ
- 非公開ページ

### Cronによる定期実行

```bash
# 毎日午前3:00にスクレイピングを実行
0 3 * * * cd /path/to/project && php artisan scrape:gais
```

#### 午前3:00に設定した理由

1. **低トラフィック時間帯**: サーバー負荷が最も低い時間
2. **日次更新**: 1日1回の更新で十分な鮮度を維持
3. **対象サイトへの配慮**: gais.jpへのアクセス負荷を最小化

### データベース構造

#### gais_pages テーブル

| カラム | 型 | 説明 |
|--------|-----|------|
| id | bigint | プライマリキー |
| url | varchar | ページURL（ユニーク） |
| title | varchar | ページタイトル |
| content | text | ページ本文 |
| event_date | date | イベント開催日（該当する場合） |
| published_at | datetime | 公開日時 |
| is_active | boolean | 有効フラグ |
| created_at | datetime | 作成日時 |
| updated_at | datetime | 更新日時 |

#### questions テーブル

| カラム | 型 | 説明 |
|--------|-----|------|
| id | bigint | プライマリキー |
| question | text | ユーザーの質問 |
| answer | text | AIの回答 |
| session_id | varchar | 識別用（IPアドレス） |
| helpful_count | integer | 「役立った」カウント |
| created_at | datetime | 作成日時 |
| updated_at | datetime | 更新日時 |

---

## セキュリティ対策

### AWS WAF（Web Application Firewall）

#### 導入目的
- SQLインジェクション対策
- クロスサイトスクリプティング（XSS）対策
- DDoS攻撃の緩和
- 不正なボットアクセスのブロック

#### 設定ルール
- AWSマネージドルールセットを適用
- レートベースルールによる過剰アクセス制限
- 地理的制限（必要に応じて）

### SSL/TLS暗号化

- **CloudFront経由でのSSL終端**
- **HTTPS強制**: HTTP→HTTPSリダイレクト
- **TLS 1.2以上を要求**

### その他のセキュリティ対策

| 対策 | 実装内容 |
|-----|---------|
| CSRF対策 | Laravelの@csrfディレクティブ使用 |
| XSS対策 | Bladeの自動エスケープ機能 |
| SQLインジェクション対策 | Eloquent ORMによるパラメータバインディング |
| セッション管理 | セキュアなセッション設定 |
| 入力バリデーション | Laravelのバリデーション機能 |

---

## ユーザーインターフェース

### デザインコンセプト

- **シンプル & クリーン**: 情報取得に集中できるミニマルなデザイン
- **アクセシビリティ**: 視認性の高い配色とフォントサイズ
- **レスポンシブ**: PC・タブレット・スマートフォン対応

### レスポンシブデザイン

#### PC表示
- フルサイズのチャットインターフェース
- ヘッダーにボタンを並列配置

#### スマートフォン表示
- ハンバーガーメニューによるナビゲーション
- タッチ操作に最適化されたボタンサイズ
- 画面幅に応じた自動レイアウト調整

### ダークモード

- **ライトモード**: 白背景・黒文字
- **ダークモード**: ダークグレー背景・白文字
- 目の疲れを軽減し、長時間利用に配慮

### アニメーション

- **タイピングインジケーター**: AI回答生成中の視覚的フィードバック
- **ポップアップ**: フェードイン/アウトによる自然な表示
- **ボタンホバー**: インタラクティブな操作感

---

## セットアップ手順

### 前提条件

- Docker & Docker Compose
- Git

### 1. リポジトリのクローン

```bash
git clone https://github.com/your-repo/gaispedia.git
cd gaispedia
```

### 2. 環境変数の設定

```bash
cp .env.example .env
```

`.env` ファイルを編集：

```env
# アプリケーション
APP_NAME="GAISペディア"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://gais-pedia.com
APP_TIMEZONE=Asia/Tokyo

# データベース
DB_CONNECTION=mysql
DB_HOST=db
DB_PORT=3306
DB_DATABASE=laravel
DB_USERNAME=laravel
DB_PASSWORD=your_secure_password

# Gemini API
GEMINI_API_KEY=your_gemini_api_key
GEMINI_MODEL=gemini-2.5-flash
```

### 3. Dockerコンテナの起動

```bash
docker-compose up -d
```

### 4. 依存関係のインストール

```bash
docker-compose exec app composer install
docker-compose exec app php artisan key:generate
```

### 5. データベースのマイグレーション

```bash
docker-compose exec app php artisan migrate
```

### 6. 初回スクレイピング

```bash
docker-compose exec app php artisan scrape:gais
```

### 7. アクセス確認

ブラウザで `http://localhost` にアクセス

---

## 運用・保守

### 定期タスク

| タスク | 頻度 | コマンド |
|-------|-----|---------|
| スクレイピング | 毎日3:00 | `php artisan scrape:gais` |
| ログローテーション | 日次 | logrotate |
| DBバックアップ | 日次 | mysqldump |

### 監視項目

- **サーバーリソース**: CPU、メモリ、ディスク使用率
- **アプリケーションログ**: `storage/logs/laravel.log`
- **Gemini API**: レスポンス時間、エラー率
- **CloudFront**: キャッシュヒット率、レイテンシ

### トラブルシューティング

#### AI回答が遅い場合
1. Gemini APIのステータス確認
2. ネットワーク接続の確認
3. タイムアウト設定の調整

#### スクレイピングが失敗する場合
1. gais.jpのサイト構造変更を確認
2. ネットワーク接続の確認
3. エラーログの確認

---

## ライセンス・謝辞

### 使用技術・サービス

- [Laravel](https://laravel.com/) - PHPフレームワーク
- [Google Gemini](https://ai.google.dev/) - AI API
- [Tailwind CSS](https://tailwindcss.com/) - CSSフレームワーク
- [AWS](https://aws.amazon.com/) - クラウドインフラ

### 謝辞

本サービスは、生成AI協会（GAIS）の公式情報をより多くの方に届けることを目的として開発されました。GAISの活動と、AI技術の発展に敬意を表します。
